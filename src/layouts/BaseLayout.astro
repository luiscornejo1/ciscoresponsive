---
export interface Props {
  title: string;
  description?: string;
  keywords?: string;
  lang?: string;
}

const { 
  title, 
  description = "Sitio web de ds3comunicaciones, líder en soluciones de redes y comunicaciones",
  keywords = "Cisco, switches, redes, comunicaciones, DS3 Comunicaciones",
  lang = "es"
} = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} class="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  <meta name="keywords" content={keywords} />
  <meta name="author" content="ds3comunicaciones" />
  
  <!-- SEO Meta Tags -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    /* === DARK MODE CSS LIMPIO Y EFECTIVO === */
    * {
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }

    /* === MODO OSCURO === */
    html.dark body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%) !important;
      color: #f1f5f9 !important;
    }

    /* Navegación */
    html.dark nav,
    html.dark header {
      background: #1e293b !important;
      border-color: #475569 !important;
    }

    /* Contenedores principales */
    html.dark main {
      background-color: transparent !important;
    }

    /* Sidebars y paneles */
    html.dark .bg-white,
    html.dark aside {
      background-color: #334155 !important;
      color: #f1f5f9 !important;
      border-color: #475569 !important;
    }

    /* Secciones de contenido */
    html.dark .bg-gray-50,
    html.dark .bg-gray-100,
    html.dark section,
    html.dark article {
      background-color: #1e293b !important;
      color: #f1f5f9 !important;
    }

    /* Texto */
    html.dark h1, html.dark h2, html.dark h3, html.dark h4, html.dark h5, html.dark h6,
    html.dark p, html.dark span, html.dark div, html.dark li,
    html.dark .text-gray-800, html.dark .text-gray-700, html.dark .text-gray-600, html.dark .text-gray-900 {
      color: #f1f5f9 !important;
    }

    /* Botones */
    html.dark button {
      background-color: #475569 !important;
      color: #f1f5f9 !important;
      border-color: #64748b !important;
    }

    html.dark button:hover {
      background-color: #64748b !important;
    }

    /* Inputs */
    html.dark input, html.dark textarea, html.dark select {
      background-color: #334155 !important;
      color: #f1f5f9 !important;
      border-color: #475569 !important;
    }

    /* Bordes */
    html.dark .border,
    html.dark .border-gray-200,
    html.dark .border-gray-300 {
      border-color: #475569 !important;
    }

    /* Footer */
    html.dark footer {
      background: linear-gradient(135deg, #0f172a, #1e293b) !important;
      color: #f1f5f9 !important;
    }

    /* === PRESERVAR ELEMENTOS IMPORTANTES === */
    html.dark img,
    html.dark svg,
    html.dark .fa-moon,
    html.dark .fa-sun,
    html.dark [class*="text-blue"]:not(.override-dark),
    html.dark [class*="text-green"]:not(.override-dark),
    html.dark [class*="bg-blue"]:not(.override-dark),
    html.dark [class*="bg-green"]:not(.override-dark),
    html.dark [class*="bg-gradient"] {
      background-color: revert !important;
      color: revert !important;
    }

    /* === ESPECÍFICOS PARA LA PÁGINA === */
    html.dark .bg-gradient-to-r.from-cisco-blue {
      background: linear-gradient(to right, #1e40af, #1d4ed8) !important;
      color: white !important;
    }

    html.dark .bg-gray-50.border-gray-200 {
      background-color: #1e293b !important;
      border-color: #475569 !important;
    }

    html.dark .bg-gradient-to-r.from-gray-50.to-white {
      background: linear-gradient(to right, #334155, #475569) !important;
    }

    html.dark .bg-gradient-to-r.from-green-50 {
      background: linear-gradient(to right, #065f46, #047857) !important;
    }

    /* Características coloridas */
    html.dark .bg-blue-100 { background-color: #1e40af !important; }
    html.dark .bg-green-100 { background-color: #065f46 !important; }
    html.dark .bg-purple-100 { background-color: #581c87 !important; }
    html.dark .bg-orange-100 { background-color: #9a3412 !important; }

    /* Tooltip */
    html.dark .tooltip {
      background-color: #334155 !important;
      color: #f1f5f9 !important;
    }

    /* Animación del botón dark mode */
    #dark-mode-toggle {
      transition: transform 0.2s ease;
    }

    #dark-mode-toggle:hover {
      transform: scale(1.05);
    }
  </style>
  
  <!-- Script para inicializar el tema antes de que cargue la página -->
  <script is:inline>
    // Detectar preferencia de tema al cargar
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>
  
  <title>{title}</title>
</head>

<body class="antialiased">
  <slot />
  
  <script>
    // Dark Mode Toggle Functionality
    document.addEventListener('DOMContentLoaded', function() {
      function initializeDarkMode() {
        const toggle = document.getElementById('dark-mode-toggle');
        const icon = document.getElementById('dark-mode-icon');
        const tooltipText = document.getElementById('tooltip-text');
        const html = document.documentElement;
        
        function updateIcon() {
          if (html.classList.contains('dark')) {
            if (icon) icon.className = 'fas fa-sun text-lg';
            if (tooltipText) tooltipText.textContent = 'Modo Claro';
          } else {
            if (icon) icon.className = 'fas fa-moon text-lg';
            if (tooltipText) tooltipText.textContent = 'Modo Oscuro';
          }
        }
        
        function toggleTheme() {
          html.classList.toggle('dark');
          const isDark = html.classList.contains('dark');
          
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          updateIcon();
          
          // Animación de feedback
          if (toggle) {
            toggle.style.transform = 'scale(0.95)';
            setTimeout(() => {
              toggle.style.transform = '';
            }, 150);
          }
          
          console.log('Dark mode:', isDark ? 'ON' : 'OFF');
        }
        
        if (toggle) {
          toggle.addEventListener('click', toggleTheme);
        }
        
        // Aplicar tema guardado
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          html.classList.add('dark');
        }
        
        updateIcon();
        
        console.log('Dark mode initialized, toggle found:', !!toggle);
      }

      // Inicializar dark mode
      initializeDarkMode();

      // === RESTO DE FUNCIONALIDADES === 
      // Galería de imágenes
      function openImageModal(src: string, alt: string) {
        const modal = document.getElementById('image-modal');
        const modalImg = document.getElementById('modal-image');
        const caption = document.getElementById('modal-caption');
        
        if (modal && modalImg && caption) {
          (modalImg as HTMLImageElement).src = src;
          (modalImg as HTMLImageElement).alt = alt;
          caption.textContent = alt;
          modal.classList.remove('hidden');
        }
      }

      function closeModal() {
        const modal = document.getElementById('image-modal');
        if (modal) {
          modal.classList.add('hidden');
        }
      }

      // Configurar imágenes clickeables
      document.querySelectorAll('.gallery-image').forEach(img => {
        img.addEventListener('click', function(this: HTMLImageElement) {
          openImageModal(this.src, this.alt);
        });
      });

      // Navegación entre imágenes
      const thumbnails = document.querySelectorAll('.thumbnail-btn');
      const mainImage = document.getElementById('main-image');

      thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener('click', function(this: HTMLElement) {
          const newSrc = this.getAttribute('data-src');
          const newAlt = this.getAttribute('data-alt');
          
          if (mainImage && newSrc) {
            (mainImage as HTMLImageElement).src = newSrc;
            (mainImage as HTMLImageElement).alt = newAlt || '';
            
            // Actualizar estado activo de thumbnails
            thumbnails.forEach(t => t.classList.remove('ring-2', 'ring-cisco-blue'));
            this.classList.add('ring-2', 'ring-cisco-blue');
          }
        });
      });

      // Pestañas
      const productTab = document.getElementById('product-tab');
      const imagesTab = document.getElementById('images-tab');
      const informationSection = document.getElementById('information-section');
      const imagesSection = document.getElementById('images-section');

      productTab?.addEventListener('click', function() {
        informationSection?.classList.remove('hidden');
        imagesSection?.classList.add('hidden');
        
        productTab.classList.add('bg-white', 'text-cisco-blue', 'border-b-2', 'border-cisco-blue');
        productTab.classList.remove('bg-gray-50', 'text-gray-600');
        
        imagesTab?.classList.add('bg-gray-50', 'text-gray-600');
        imagesTab?.classList.remove('bg-white', 'text-cisco-blue', 'border-b-2', 'border-cisco-blue');
      });

      imagesTab?.addEventListener('click', function() {
        informationSection?.classList.add('hidden');
        imagesSection?.classList.remove('hidden');
        
        imagesTab?.classList.add('bg-white', 'text-cisco-blue', 'border-b-2', 'border-cisco-blue');
        imagesTab?.classList.remove('bg-gray-50', 'text-gray-600');
        
        productTab?.classList.add('bg-gray-50', 'text-gray-600');
        productTab?.classList.remove('bg-white', 'text-cisco-blue', 'border-b-2', 'border-cisco-blue');
      });

      // Cerrar modal con Escape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeModal();
        }
      });
      
      // Cerrar modal al hacer clic fuera
      const modal = document.getElementById('image-modal');
      modal?.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeModal();
        }
      });

      // Manejo de sidebars móviles
      const mobileBrandsBtn = document.getElementById('mobile-brands-btn');
      const mobilePricesBtn = document.getElementById('mobile-prices-btn');
      const brandsSidebar = document.getElementById('brands-sidebar');
      const pricesSidebar = document.getElementById('prices-sidebar');
      const mobileOverlay = document.getElementById('mobile-overlay');
      const closeBrands = document.getElementById('close-brands');
      const closePrices = document.getElementById('close-prices');

      mobileBrandsBtn?.addEventListener('click', function() {
        brandsSidebar?.classList.remove('-translate-x-full');
        brandsSidebar?.classList.add('translate-x-0');
        mobileOverlay?.classList.remove('hidden');
      });

      mobilePricesBtn?.addEventListener('click', function() {
        pricesSidebar?.classList.remove('translate-x-full');
        pricesSidebar?.classList.add('translate-x-0');
        mobileOverlay?.classList.remove('hidden');
      });

      closeBrands?.addEventListener('click', function() {
        brandsSidebar?.classList.add('-translate-x-full');
        brandsSidebar?.classList.remove('translate-x-0');
        mobileOverlay?.classList.add('hidden');
      });

      closePrices?.addEventListener('click', function() {
        pricesSidebar?.classList.add('translate-x-full');
        pricesSidebar?.classList.remove('translate-x-0');
        mobileOverlay?.classList.add('hidden');
      });

      mobileOverlay?.addEventListener('click', function() {
        brandsSidebar?.classList.add('-translate-x-full');
        pricesSidebar?.classList.add('translate-x-full');
        mobileOverlay?.classList.add('hidden');
      });
    });
  </script>
</body>
</html>
